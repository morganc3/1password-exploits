document.addEventListener("B5WebReady", function (event) {
    if (event.detail.capabilities.SessionInit === 1) {
        window.webkit.messageHandlers.sessionInitHandler.postMessage("");
    }

    if (event.detail.capabilities.DeviceInit === 1) {
        window.webkit.messageHandlers.deviceInitHandler.postMessage("");
    }

    if (event.detail.capabilities.CustomAutosave === 1) {
        document.addEventListener("B5SignInSucceeded", function (event_b) {
            window.webkit.messageHandlers.opLoginDictHandler.postMessage(event_b.detail);
        }, false);
    }
});

document.dispatchEvent(
    new CustomEvent("B5OPXReady", {
        "detail": {
            "capabilities": {
                "SessionInit": 1,
                "DeviceInit": 1,
                "CustomAutosave": 1
            }
        }
    })
);

function registerForEventListener(eventName) {
    document.addEventListener(eventName, function (event) {
                                body = {name: eventName, payload: event.details}
                                window.webkit.messageHandlers.eventDispatched.postMessage(body);
    });
    return eventName;
}
